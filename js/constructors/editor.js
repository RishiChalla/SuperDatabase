function Editor(){this.elems={lines:document.getElementById("lines"),parent:document.getElementById("textEditor"),code:document.getElementById("code")};this.code="";this.elems.code.addEventListener("focusout",this.onchange.bind(this));this.elems.code.addEventListener("paste",this.onchange.bind(this));this.elems.code.addEventListener("cut",this.onchange.bind(this));this.elems.code.addEventListener("keydown",this.commands.bind(this))};Editor.prototype.loadCode=function(code){this.code=code;this.elems.code.innerText=code;this.highlight()};Editor.prototype.onchange=function(){this.code=this.elems.code.innerText;this.highlight()};Editor.prototype.commands=function(e){};Editor.prototype.highlight=function(){var lines=this.elems.code.innerText.split("\n");this.elems.lines.innerHTML="";for(var i=0;i<lines.length;i++){lines[i]=this.highlightLine(i);this.elems.lines.innerHTML+=(i+1)+"<br>"}this.elems.code.innerHTML=lines.join("<br>");if(this.elems.code.clientHeight>this.elems.lines.clientHeight)this.elems.lines.style.height=this.elems.code.clientHeight+"px";else this.elems.lines.style.height=undefined};Editor.prototype.highlightLine=function(i){var lines=this.elems.code.innerText.split("\n");let line=lines[i];if(line.indexOf("@cell")!=0&&line.indexOf("@row")!=0&&line.indexOf("@column")!=0&&line.indexOf("//")!=0){line='<span class="invalid">'+line+'</span>';return line}else{line=line.replace("@cell",(a)=>'<span class="keyword">'+a+'</span>');line=line.replace("@column",(a)=>'<span class="keyword">'+a+'</span>');line=line.replace("@row",(a)=>'<span class="keyword">'+a+'</span>');if(line.indexOf("//")==0)line='<span class="comment">'+line+'</span>'}if(line.indexOf("<span class=\"keyword\">@cell")==0){line=line.replace(/\d{1,2}:\d{1,3}/,(a)=>'<span class="number">'+a+'</span>');line=line.replace(/\(\*(.*?)\*\)/,(a)=>'<span class="string">'+a+'</span>');let count=line.match(/#[0-9a-f]{6,6};/g).length;let counter=0;line=line.replace(/#[0-9a-f]{6,6};/g,function(a){counter+=1;if(counter>=count-1)return'<span class="number">'+a+'</span>';else return a});count=line.match(/\"(.*?)\"/g).length;counter=0;line=line.replace(/\"(.*?)\"/g,function(a){counter+=1;if(counter==count)return'<span class="string">'+a+'</span>';else if(counter==count-1){var toReturn='<span class="string">'+a.replace(/\d{1,3}px/,(b)=>'<span class="number">'+b+'</span>')+'</span>';return toReturn}else return a});count=line.match(/true|false/g).length;counter=0;line=line.replace(/true|false/g,function(a){counter+=1;if(counter>=count-4)return'<span class="number">'+a+'</span>';else return a})}if(line.indexOf("<span class=\"keyword\">@column")==0){line=line.replace(/\d{1,5}/g,(a)=>'<span class="number">'+a+'</span>');line=line.replace(/x:|w:/g,(a)=>'<span class="library">'+a.replace(/:/,"")+'</span>:')}if(line.indexOf("<span class=\"keyword\">@row")==0){line=line.replace(/\d{1,5}/g,(a)=>'<span class="number">'+a+'</span>');line=line.replace(/y:|h:/g,(a)=>'<span class="library">'+a.replace(/:/,"")+'</span>:')}lines[i]=line;if(lines[i].indexOf("@cell")==0){try{let address=lines[i].match(/\d{1,2}:\d{1,3}/g)[0].split(":");let content=lines[i].match(/\(\*(.*?)\*\)/g)[0];content=content.replace("(*","");content=content.substring(0,content.length-2);content=content.replace(/\\\*/g,"\\*");content=content.replace(/\\\"/g,"\"");content=content.replace(/\\\\/g,"\\");content=content.replace(/\\\(/g,"(");content=content.replace(/\\\)/g,")");let remainingLine=lines[i].replace(/\@cell\(\d{1,2}:\d{1,3};\(\*(.*?)\*\);/g,"").replace(/\)/g,"");let colors=remainingLine.match(/#[0-9a-f]{6}/g);let bgColor=colors[0];let textColor=colors[1];remainingLine=remainingLine.replace(/#[0-9a-f]{6};#[0-9a-f]{6};/g,"");let remainingParts=remainingLine.split(";");let align=remainingParts[0].replace("\"","");let font=remainingParts[1].replace("\"","");let dataType=remainingParts[2].match(/\"(.*?)\"/g)[0].replace(/\"/g,"");let bold=remainingParts[2].replace(/\"(.*?)\"/g,"")=="true"?!0:!1;let italic=remainingParts[3]=="true"?!0:!1;let underline=remainingParts[4]=="true"?!0:!1;let strike=remainingParts[5]=="true"?!0:!1}catch(e){lines[i]='<span class="invalid">'+lines[i]+'</span>'}}if(lines[i].indexOf("@column")==0){try{let x=Number(lines[i].match(/x:\d{1,3}/g)[0].replace("x:",""));let width=Number(lines[i].match(/w:\d{1,5}/g)[0].replace("w:",""))}catch(e){lines[i]='<span class="invalid">'+lines[i]+'</span>'}}if(lines[i].indexOf("@row")==0){try{let y=Number(lines[i].match(/y:\d{1,3}/g)[0].replace("y:",""));let height=Number(lines[i].match(/h:\d{1,5}/g)[0].replace("h:",""))}catch(e){lines[i]='<span class="invalid">'+lines[i]+'</span>'}}return lines[i]}