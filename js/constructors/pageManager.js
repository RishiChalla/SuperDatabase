function PageManager(){this.table=new Table();this.editor=new Editor();var parent=document.getElementById("rightEditor");var self=this;var xParent=document.getElementById("x");for(var x=1;x<this.table.rows.length+1;x++){var elem=document.createElement("span");elem.innerHTML=x;elem.style.height=(this.table.rows[x-1].height-2)+"px";xParent.appendChild(elem);var bottom=document.createElement("div");bottom.classList.add("bottom");elem.appendChild(bottom);this.table.rows[x-1].bottom=bottom;this.table.rows[x-1].elem=elem;this.table.rows[x-1].addEventListener(function(y,h){self.table.changeRowHeight(y,h);});} var yParent=document.getElementById("y");for(var y=1;y<this.table.columns.length+1;y++){var elem=document.createElement("span");elem.innerHTML=y;elem.style.width=(this.table.columns[y-1].width-2)+"px";yParent.appendChild(elem);var right=document.createElement("div");right.classList.add("right");elem.appendChild(right);this.table.columns[y-1].right=right;this.table.columns[y-1].elem=elem;this.table.columns[y-1].addEventListener(function(x,w){self.table.changeColumnWidth(x,w);});} parent.onscroll=function(){parent.scrollLeft=this.scrollLeft;parent.scrollTop=this.scrollTop;xParent.scrollTop=this.scrollTop;yParent.scrollLeft=this.scrollLeft;};document.getElementById("position").onchange=function(){var pos=this.value;if(pos.match(/^d{1,3}:d{1,3}$/)){self.table.selectCell(new Point(pos.split(":")[0],pos.split(":")[1]));} return;};document.getElementById("file").onchange=function(){var rawFile=this.files[0];if(!rawFile)return;var reader=new FileReader();reader.onload=function(e){var file=e.target.result;self.table.loadFromFile(file);};reader.onerror=function(){alert("That file was unreadable, try a different one.");};reader.readAsText(rawFile,"UTF-8");};document.getElementById("downloadFile").onclick=function(){var file=self.table.saveFile();download("untitled.sdb",file);};document.getElementById("alignLeft").onclick=function(){var active=self.table.getActiveCell();for(var i=0;i<active.length;i++){active[i].align="left";active[i].input.style["text-align"]="left";}};document.getElementById("alignCenter").onclick=function(){var active=self.table.getActiveCell();for(var i=0;i<active.length;i++){active[i].align="center";active[i].input.style["text-align"]="center";}};document.getElementById("alignRight").onclick=function(){var active=self.table.getActiveCell();for(var i=0;i<active.length;i++){active[i].align="right";active[i].input.style["text-align"]="right";}};document.getElementById("bgColor").onchange=function(){var active=self.table.getActiveCell();for(var i=0;i<active.length;i++){active[i].bgColor=this.value;active[i].input.style["background-color"]=this.value;}};document.getElementById("textColor").onchange=function(){var active=self.table.getActiveCell();for(var i=0;i<active.length;i++){active[i].textColor=this.value;active[i].input.style["color"]=this.value;}};document.getElementById("fontFamily").onchange=function(){var active=self.table.getActiveCell();for(var i=0;i<active.length;i++){let str=active[i].font;let font=str.replace(str.substring(str.indexOf("px")).replace("px ",""),this.value);active[i].font=font;active[i].input.style["font-family"]=this.value;}};document.getElementById("fontSize").onchange=function(){var active=self.table.getActiveCell();for(var i=0;i<active.length;i++){let str=active[i].font;let font=str.replace(/^d{1,3}/g,this.value);active[i].font=font;active[i].input.style["font-size"]=this.value+"px";}};document.getElementById("bold").onclick=function(){var active=self.table.getActiveCell();for(var i=0;i<active.length;i++){active[i].bold=!active[i].bold;active[i].input.style["font-weight"]=active[i].bold?"bold":"normal";}};document.getElementById("italic").onclick=function(){var active=self.table.getActiveCell();for(var i=0;i<active.length;i++){active[i].italic=!active[i].italic;active[i].input.style["font-style"]=active[i].italic?"italic":"normal";}};document.getElementById("strike").onclick=function(){var active=self.table.getActiveCell();for(var i=0;i<active.length;i++){active[i].strike=!active[i].strike;active[i].input.style["text-decoration"]=active[i].strike?"line-through":"normal";}};document.getElementById("underline").onclick=function(){var active=self.table.getActiveCell();for(var i=0;i<active.length;i++){active[i].underline=!active[i].underline;active[i].input.style["text-decoration"]=active[i].underline?"underline":"normal";}};document.getElementById("dataType").onchange=function(){var active=self.table.getActiveCell();for(var i=0;i<active.length;i++){active[i].dataType=this.value;}};document.getElementById("formulas").onchange=function(){document.getElementById("modal").style.display="block";document.getElementById("modalOverlay").style.display="block";var argumentsElem=document.getElementById("arguments");argumentsElem.innerHTML="";document.getElementById("modalTitle").innerText="Formula Wizard: "+this.value;for(var i=0;i<summaries[this.value].args.length;i++){if(summaries[this.value].args[i]=="...")continue;let label=document.createElement("label");let input=document.createElement("input");label.innerText=summaries[this.value].args[i];input.classList.add("arg");input.placeholder=label.innerText;argumentsElem.append(label);argumentsElem.append(input);} if(summaries[this.value].args.length>0&&summaries[this.value].args[summaries[this.value].args.length-1]=="..."){document.getElementById("moreArgs").disabled=false;} else{document.getElementById("moreArgs").disabled=true;} var value=this.value;document.getElementById("moreArgs").onclick=function(){let label=document.createElement("label");let input=document.createElement("input");label.innerText=summaries[value].args[0];input.classList.add("arg");input.placeholder=label.innerText;argumentsElem.append(label);argumentsElem.append(input);};document.getElementById("insert").onclick=function(){var formula=value+"(";var inputs=document.getElementsByClassName("arg");for(var i=0;i<inputs.length;i++){formula+=inputs[i].value;if(i!=inputs.length-1)formula+=", ";} formula+=")";var activeCells=self.table.getActiveCell();for(var i=0;i<activeCells.length;i++){activeCells[i].input.focus();activeCells[i].input.value+=formula;} document.getElementById("cancel").click();};document.getElementById("cancel").onclick=function(){document.getElementById("modal").style.display="none";document.getElementById("modalOverlay").style.display="none";document.getElementById("moreArgs").onclick=undefined;document.getElementById("insert").onclick=undefined;this.onclick=undefined;};};document.getElementById("openTextEditor").onclick=function(){document.getElementById("rightEditor").style.display="none";document.getElementById("textEditor").style.display="block";document.getElementById("openEditor").disabled=false;this.disabled=true;self.editor.loadCode(self.table.saveFile());};document.getElementById("openEditor").onclick=function(){document.getElementById("rightEditor").style.display="block";document.getElementById("textEditor").style.display="none";document.getElementById("openTextEditor").disabled=false;this.disabled=true;self.table.loadFromFile(self.editor.code);};};