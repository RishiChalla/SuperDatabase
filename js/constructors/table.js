function Table(e,t){this.cells=[],this.mergedCells=[],this.columns=[],this.rows=[];var l=new Box(100,30);this.defaultCellSize=l;for(var i=document.getElementById("rightEditor"),n=1;n<501;n++){for(var o=1;o<51;o++)this.cells.push(new Cell(new Point(o,n),"","#ffffff","#333333","20px Arial",Object.assign({},l)));i.appendChild(document.createElement("br"))}for(var r=1;r<51;r++)this.columns.push(new Column(r,l.width));for(var s=1;s<501;s++)this.rows.push(new Row(s,l.height))}Table.prototype.changeColumnWidth=function(e,t){var l=this.column(e);if(null!=l){l.width=t,l.elem.style.width=t-2+"px";for(var i=this.rows.length-1;i>=0;i--)this.findCell(new Point(e,this.rows[i].y)).input.style.width=t-2+"px"}},Table.prototype.changeRowHeight=function(e,t){var l=this.row(e);if(null!=l){l.height=t,l.elem.style.height=t-2+"px";for(var i=this.columns.length-1;i>=0;i--)this.findCell(new Point(this.columns[i].x,e)).input.style.height=t-2+"px"}},Table.prototype.findCell=function(e){for(var t=this.cells.length-1;t>=0;t--)if(this.cells[t].position.x==e.x&&this.cells[t].position.y==e.y)return this.cells[t];for(t=this.mergedCells.length-1;t>=0;t--)if(this.mergedCells[t].contains(e))return this.mergedCells[t]},Table.prototype.column=function(e){for(var t=this.columns.length-1;t>=0;t--)if(this.columns[t].x==e)return this.columns[t]},Table.prototype.row=function(e){for(var t=this.rows.length-1;t>=0;t--)if(this.rows[t].y==e)return this.rows[t]},Table.prototype.selectCell=function(e){var t=this.getActiveCell();if(t.length>=1)for(var l=0;l<t.length;l++)t[l].active=!1,t[l].removeActive();var i=this.findCell(e);if(i){i.active=!0,i.input.scrollIntoView();var n=document.getElementById("rightEditor");n.scrollTop+=n.innerHeight/2,n.scrollLeft-=n.innerWidth/2,i.input.focus();var o=document.getElementsByClassName("textAlign");for(l=0;l<o.length;l++)o[l].classList.remove("active");"left"==i.textAlign&&document.getElementById("alignLeft").classList.add("active"),"center"==i.textAlign&&document.getElementById("alignCenter").classList.add("active"),"right"==i.textAlign&&document.getElementById("alignRight").classList.add("active"),document.getElementById("bgColor").value=i.bgColor,document.getElementById("textColor").value=i.textColor,document.getElementById("fontFamily").value=i.font.substring(i.font.indexOf("px")).replace("px ",""),document.getElementById("fontSize").value=i.font.substring(0,i.font.indexOf("px")),i.bold?document.getElementById("bold").classList.add("active"):document.getElementById("bold").classList.remove("active"),i.italic?document.getElementById("italic").classList.add("active"):document.getElementById("italic").classList.remove("active"),i.underline?document.getElementById("underline").classList.add("active"):document.getElementById("underline").classList.remove("active"),i.strike?document.getElementById("strike").classList.add("active"):document.getElementById("strike").classList.remove("active"),document.getElementById("dataType").value=i.dataType}},Table.prototype.selectCells=function(e){var t,l=this.getActiveCell();if(l.length>=1)for(var i=0;i<l.length;i++)l[i].active=!1,l[i].removeActive();for(i=0;i<e.length;i++){let l=this.findCell(e[i]);l&&(l.active=!0,t=l)}t.input.scrollIntoView();var n=document.getElementById("rightEditor");n.scrollTop+=n.innerHeight/2,n.scrollLeft-=n.innerWidth/2,t.input.focus()},Table.prototype.getActiveCell=function(){for(var e=[],t=0;t<this.cells.length;t++)1==this.cells[t].active&&e.push(this.cells[t]);return e},Table.prototype.saveFile=function(){for(var e="",t=this.cells.length-1;t>=0;t--){var l=this.cells[t];if(""!=l.content||"#ffffff"!=l.bgColor||"#333333"!=l.textColor||"20px Arial"!=l.font||"left"!=l.align||l.bold||l.italic||l.underline||l.strike){var i=l.content;i=(i=(i=(i=(i=i.replace(/\*/g,"\\*")).replace(/\"/g,'\\"')).replace(/\\/g,"\\\\")).replace(/\(/g,"\\(")).replace(/\)/g,"\\)"),e=e+"@cell("+l.position.x+":"+l.position.y+";(*"+i+"*);"+l.bgColor+";"+l.textColor+';"'+l.align+";"+l.font+'";"'+l.dataType+'"'+l.bold+";"+l.italic+";"+l.underline+";"+l.strike+")\n"}}for(t=this.columns.length-1;t>=0;t--){var n=this.columns[t];n.width!=this.defaultCellSize.width&&(e=e+"@column(x:"+n.x+";w:"+n.width+";)\n")}for(t=this.rows.length-1;t>=0;t--){var o=this.rows[t];o.height!=this.defaultCellSize.height&&(e=e+"@row(y:"+o.y+";h:"+o.height+";)\n")}return e},Table.prototype.loadFromFile=function(e){for(var t=e.split("\n"),l=0;l<t.length;l++)if("@"==t[l].charAt(0)){if(0==t[l].indexOf("@cell")){let e=t[l].match(/\d{1,2}:\d{1,3}/g)[0].split(":"),i=this.findCell(new Point(e[0],e[1])),n=t[l].match(/\(\*(.*?)\*\)/g)[0];n=(n=(n=(n=(n=(n=(n=n.replace("(*","")).substring(0,n.length-2)).replace(/\\\*/g,"\\*")).replace(/\\\"/g,'"')).replace(/\\\\/g,"\\")).replace(/\\\(/g,"(")).replace(/\\\)/g,")"),i.content=n,i.input.value=n;let o=t[l].replace(/\@cell\(\d{1,2}:\d{1,3};\(\*(.*?)\*\);/g,"").replace(/\)/g,""),r=o.match(/#[0-9a-f]{6}/g);i.bgColor=r[0],i.input.style["background-color"]=r[0],i.textColor=r[1],i.input.style.color=r[1];let s=(o=o.replace(/#[0-9a-f]{6};#[0-9a-f]{6};/g,"")).split(";");i.align=s[0].replace('"',""),i.input.style["text-align"]=i.align,i.font=s[1].replace('"',""),i.input.style.font=i.font,i.dataType=s[2].match(/\"(.*?)\"/g)[0].replace(/\"/g,""),i.bold="true"==s[2].replace(/\"(.*?)\"/g,""),i.input.style["font-weight"]=i.bold?"bold":"normal",i.italic="true"==s[3],i.input.style["font-style"]=i.italic?"italic":"normal",i.underline="true"==s[4],i.input.style["text-decoration"]=i.underline?"underline":"normal",i.strike="true"==s[5],i.input.style["text-decoration"]=i.strike?"line-through":"normal"}0==t[l].indexOf("@column")&&this.changeColumnWidth(Number(t[l].match(/x:\d{1,3}/g)[0].replace("x:","")),Number(t[l].match(/w:\d{1,5}/g)[0].replace("w:",""))),0==t[l].indexOf("@row")&&this.changeRowHeight(Number(t[l].match(/y:\d{1,3}/g)[0].replace("y:","")),Number(t[l].match(/h:\d{1,5}/g)[0].replace("h:","")))}};